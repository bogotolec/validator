name: tests

inputs:
  GITHUB_TOKEN:
    required: true
  ROBLOX_TEST_API_KEY:
    required: true

runs:
  using: "composite"
  steps:
  - name: Checkout Code
    uses: actions/checkout@v4

  - name: Install aftman
    uses: ok-nick/setup-aftman@v0.4.2
    with:
        token: ${{ inputs.GITHUB_TOKEN }}

  - name: Install wally packages
    run: wally install
    shell: bash

  - name: Build test place
    run: rojo build -o test.rbxl test/default.project.json
    shell: bash

  - name: Run tests task
    run: lune run cloud/execute_task.luau test.rbxl test/run.lua
    shell: bash
    env:
        ROBLOX_API_KEY: ${{ inputs.ROBLOX_TEST_API_KEY }}